"use strict";(globalThis.webpackChunkbetareader_app_site=globalThis.webpackChunkbetareader_app_site||[]).push([[84],{3084(e,n,t){t.d(n,{BetareaderPage:()=>ce});var r=t(6540),o=t(2548),a=t(977),l=t(7087),s=t(6679);const i=s.J1`
  mutation BetaReaderController_analyzeIssues($text: String!, $language: String) {
    BetaReaderController_analyzeIssues(text: $text, language: $language) {
      id
      type
      fragment
      description
      suggestion
    }
  }
`,c=s.J1`
  mutation BetaReaderController_analyzeLogic($text: String!, $language: String) {
    BetaReaderController_analyzeLogic(text: $text, language: $language) {
      id
      type
      fragment
      description
      suggestion
    }
  }
`,d=s.J1`
  mutation BetaReaderController_analyzeCharacters($text: String!, $language: String) {
    BetaReaderController_analyzeCharacters(text: $text, language: $language) {
      name
      description
      role
    }
  }
`,g=s.J1`
  mutation BetaReaderController_scoreText($text: String!, $language: String) {
    BetaReaderController_scoreText(text: $text, language: $language) {
      general {
        score
        description
      }
      plotLogic {
        score
        description
      }
      characters {
        score
        description
      }
      readability {
        score
        description
      }
    }
  }
`,u=s.J1`
  mutation BetaReaderController_analyzeText($text: String!, $language: String) {
    BetaReaderController_analyzeText(text: $text, language: $language) {
      issues {
        id
        type
        fragment
        description
        suggestion
      }
      logicIssues {
        id
        type
        fragment
        description
        suggestion
      }
      characters {
        name
        description
        role
      }
      scoring {
        general {
          score
          description
        }
        plotLogic {
          score
          description
        }
        characters {
          score
          description
        }
        readability {
          score
          description
        }
      }
    }
  }
`;var x=t(1965),y=t(836),p=t(8882);const{hostname:h}=window.location,f="betareader.app"===h||"www.betareader.app"===h?"https://api.betareader.app":window.location.origin,j=new x.R({link:new y.P({uri:`${f}/public-api/graphql/v1`}),cache:new p.D({addTypename:!1}),defaultOptions:{query:{fetchPolicy:"no-cache",errorPolicy:"all"},mutate:{fetchPolicy:"no-cache",errorPolicy:"all"}}}),m="documents",A="main_doc";function b(){return new Promise((e,n)=>{const t=indexedDB.open("betareader_db",1);t.onupgradeneeded=()=>{t.result.createObjectStore(m)},t.onsuccess=()=>e(t.result),t.onerror=()=>n(t.error)})}function z(e){return e.innerText??""}function S(e){return e.trim().split(/\s+/).filter(Boolean).length}var w=t(757),C=t(4800),v=t(1415),k=t(9754),R=t(1509),T=t(3840),B=t(9252),I=t(2792);const $=[{code:"auto",label:"\u0410\u0432\u0442\u043e"},{code:"ru",label:"\u0420\u0443\u0441\u0441\u043a\u0438\u0439"},{code:"en",label:"English"},{code:"uk",label:"\u0423\u043a\u0440\u0430\u0457\u043d\u0441\u044c\u043a\u0430"},{code:"de",label:"Deutsch"},{code:"fr",label:"Fran\xe7ais"},{code:"es",label:"Espa\xf1ol"},{code:"it",label:"Italiano"}],L={Spelling:"red",Repetition:"orange",Logic:"purple",Style:"green"},_={main:"gold",secondary:"blue",mentioned:"default"},D={main:"\u0413\u043b\u0430\u0432\u043d\u044b\u0439",secondary:"\u0412\u0442\u043e\u0440\u043e\u0441\u0442\u0435\u043f\u0435\u043d\u043d\u044b\u0439",mentioned:"\u0423\u043f\u043e\u043c\u044f\u043d\u0443\u0442\u044b\u0439"},G={general:"\u041e\u0431\u0449\u0435\u0435 \u0432\u043e\u0441\u043f\u0440\u0438\u044f\u0442\u0438\u0435",plotLogic:"\u041b\u043e\u0433\u0438\u043a\u0430 \u0441\u044e\u0436\u0435\u0442\u0430",characters:"\u041f\u0440\u043e\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043f\u0435\u0440\u0441\u043e\u043d\u0430\u0436\u0435\u0439",readability:"\u0427\u0438\u0442\u0430\u0435\u043c\u043e\u0441\u0442\u044c"};var H=t(4848);function P({editorRef:e,language:n,onLanguageChange:t,fontSize:r,onFontSizeChange:o}){const a=(n,t)=>{e.current?.focus(),document.execCommand(n,!1,t)};return(0,H.jsxs)(l.A,{align:"center",gap:4,style:{padding:"6px 10px",borderBottom:"1px solid #f0f0f0",background:"#fafafa",flexShrink:0},children:[(0,H.jsx)(C.A,{title:"\u041f\u043e\u043b\u0443\u0436\u0438\u0440\u043d\u044b\u0439 (Ctrl+B)",children:(0,H.jsx)(v.Ay,{size:"small",icon:(0,H.jsx)(T.A,{}),onMouseDown:e=>{e.preventDefault(),a("bold")}})}),(0,H.jsx)(C.A,{title:"\u041a\u0443\u0440\u0441\u0438\u0432 (Ctrl+I)",children:(0,H.jsx)(v.Ay,{size:"small",icon:(0,H.jsx)(B.A,{}),onMouseDown:e=>{e.preventDefault(),a("italic")}})}),(0,H.jsx)(C.A,{title:"\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a H1",children:(0,H.jsx)(v.Ay,{size:"small",onMouseDown:e=>{e.preventDefault(),a("formatBlock","h1")},children:"H1"})}),(0,H.jsx)(C.A,{title:"\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a H2",children:(0,H.jsx)(v.Ay,{size:"small",onMouseDown:e=>{e.preventDefault(),a("formatBlock","h2")},children:"H2"})}),(0,H.jsx)(C.A,{title:"\u041e\u0431\u044b\u0447\u043d\u044b\u0439 \u0430\u0431\u0437\u0430\u0446",children:(0,H.jsx)(v.Ay,{size:"small",icon:(0,H.jsx)(I.A,{}),onMouseDown:e=>{e.preventDefault(),a("formatBlock","p")}})}),(0,H.jsx)(k.A,{type:"vertical",style:{margin:"0 4px"}}),(0,H.jsx)(C.A,{title:"\u042f\u0437\u044b\u043a \u043f\u043e\u0434\u0441\u043a\u0430\u0437\u043e\u043a \u0438 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0439 \u043e\u0442 AI",children:(0,H.jsx)(R.A,{size:"small",value:n,onChange:t,style:{width:110},options:$.map(e=>({value:e.code,label:e.label}))})}),(0,H.jsx)(k.A,{type:"vertical",style:{margin:"0 4px"}}),(0,H.jsx)(C.A,{title:"\u0423\u043c\u0435\u043d\u044c\u0448\u0438\u0442\u044c \u0448\u0440\u0438\u0444\u0442",children:(0,H.jsx)(v.Ay,{size:"small",disabled:r<=11,onClick:()=>{o(Math.max(11,r-1)),e.current?.focus()},children:"A\u2212"})}),(0,H.jsxs)("span",{style:{fontSize:12,color:"#8c8c8c",minWidth:30,textAlign:"center"},children:[r,"px"]}),(0,H.jsx)(C.A,{title:"\u0423\u0432\u0435\u043b\u0438\u0447\u0438\u0442\u044c \u0448\u0440\u0438\u0444\u0442",children:(0,H.jsx)(v.Ay,{size:"small",disabled:r>=32,onClick:()=>{o(Math.min(32,r+1)),e.current?.focus()},children:"A+"})})]})}const{Text:E}=w.A;function F({editorRef:e,language:n,onLanguageChange:t,wordCount:o,lastSaved:a,onInput:s}){const[i,c]=(0,r.useState)(17);return(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(P,{editorRef:e,language:n,onLanguageChange:t,fontSize:i,onFontSizeChange:c}),(0,H.jsx)("div",{ref:e,contentEditable:!0,suppressContentEditableWarning:!0,onInput:s,"data-placeholder":"\u041d\u0430\u0447\u043d\u0438\u0442\u0435 \u043f\u0438\u0441\u0430\u0442\u044c \u0433\u043b\u0430\u0432\u0443 \u0437\u0434\u0435\u0441\u044c\u2026\n\n\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 \u043f\u0430\u043d\u0435\u043b\u044c \u0438\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442\u043e\u0432 \u0434\u043b\u044f \u0416\u0438\u0440\u043d\u043e\u0433\u043e, \u041a\u0443\u0440\u0441\u0438\u0432\u0430 \u0438 \u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u043e\u0432.\n\u0422\u0435\u043a\u0441\u0442 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u0442\u0441\u044f \u0432 \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0435 \u043a\u0430\u0436\u0434\u044b\u0435 10 \u0441\u0435\u043a\u0443\u043d\u0434.\n\n\u041d\u0430\u0436\u043c\u0438\u0442\u0435 \xabAnalyze\xbb \u0432 \u043f\u0440\u0430\u0432\u043e\u0439 \u043f\u0430\u043d\u0435\u043b\u0438 \u0447\u0442\u043e\u0431\u044b \u043d\u0430\u0439\u0442\u0438 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u044b.",style:{flex:1,overflowY:"auto",padding:"24px 32px",outline:"none",fontSize:i,lineHeight:1.8,fontFamily:'"Georgia", "Times New Roman", serif',color:"#1a1a1a",whiteSpace:"pre-wrap",wordBreak:"break-word"}}),(0,H.jsxs)(l.A,{justify:"space-between",align:"center",style:{padding:"6px 16px",borderTop:"1px solid #f0f0f0",background:"#fafafa",flexShrink:0},children:[(0,H.jsxs)(E,{type:"secondary",style:{fontSize:12},children:["\u0421\u043b\u043e\u0432: ",(0,H.jsx)("strong",{children:o})]}),(0,H.jsx)(E,{type:"secondary",style:{fontSize:12},children:a?`\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u043e \u0432 ${a.toLocaleTimeString()}`:"\u041d\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u043e"})]})]})}var M=t(2188),N=t(7354),O=t(1682),W=t(4423),J=t(5487),Y=t(4709),q=t(4204),X=t(5954),K=t(5901),Z=t(91);const{Text:Q}=w.A;function U({issue:e,onGoTo:n,onIgnore:t,onApply:o,hideApply:a=!1}){const[l,s]=(0,r.useState)(!1);return(0,H.jsxs)(N.A,{size:"small",style:{marginBottom:8,borderRadius:6},styles:{body:{padding:"8px 12px"}},title:(0,H.jsx)(O.A,{color:L[e.type]??"default",style:{margin:0},children:e.type}),children:[(0,H.jsxs)("blockquote",{style:{borderLeft:"3px solid #d9d9d9",marginLeft:0,paddingLeft:10,color:"#595959",fontStyle:"italic",fontSize:13,marginBottom:6},children:['"',e.fragment,'"']}),(0,H.jsx)(Q,{type:"secondary",style:{fontSize:13,display:"block",marginBottom:8},children:e.description}),!a&&l&&(0,H.jsxs)("div",{style:{background:"#f6ffed",border:"1px solid #b7eb8f",borderRadius:4,padding:"6px 10px",marginBottom:8,fontSize:13},children:[(0,H.jsx)(Q,{strong:!0,style:{display:"block",marginBottom:4,fontSize:12,color:"#52c41a"},children:"\u041f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u0435:"}),(0,H.jsxs)(Q,{style:{fontSize:13},children:['"',e.suggestion,'"']}),(0,H.jsx)("div",{style:{marginTop:6},children:(0,H.jsx)(v.Ay,{size:"small",type:"primary",onClick:()=>{o(e.fragment,e.suggestion),s(!1)},children:"Apply"})})]}),(0,H.jsxs)(Z.A,{size:4,children:[(0,H.jsx)(v.Ay,{size:"small",onClick:()=>n(e.fragment),children:"Go to"}),!a&&(0,H.jsx)(v.Ay,{size:"small",onClick:()=>s(e=>!e),children:l?"Hide":"Suggest"}),(0,H.jsx)(v.Ay,{size:"small",danger:!0,onClick:()=>t(e.id),children:"Ignore"})]})]})}const{Text:V}=w.A,ee="AI-\u0441\u0435\u0440\u0432\u0438\u0441 \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e \u043d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d. \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u043f\u043e\u0437\u0436\u0435.";function ne(e){return e>=9?{label:"\u041e\u0442\u043b\u0438\u0447\u043d\u043e",color:"success"}:e>=7?{label:"\u0423\u0431\u0435\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e",color:"purple"}:e>=5?{label:"\u0415\u0441\u0442\u044c \u043f\u043e\u0442\u0435\u043d\u0446\u0438\u0430\u043b",color:"cyan"}:e>=3?{label:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442 \u0440\u0430\u0431\u043e\u0442\u044b",color:"orange"}:{label:"\u041d\u0443\u0436\u043d\u0430 \u0434\u043e\u0440\u0430\u0431\u043e\u0442\u043a\u0430",color:"error"}}function te({icon:e,text:n,action:t}){return(0,H.jsxs)(l.A,{vertical:!0,align:"center",justify:"center",style:{paddingTop:40,gap:12},children:[e&&(0,H.jsx)("div",{style:{fontSize:32,color:"#bfbfbf"},children:e}),(0,H.jsx)(V,{type:"secondary",children:n}),t]})}function re({onClick:e}){return(0,H.jsx)(v.Ay,{size:"small",icon:(0,H.jsx)(Y.A,{}),onClick:e,children:"\u041f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u044c"})}function oe({status:e,issues:n,ignored:t,showIgnored:r,onGoTo:o,onIgnore:a,onApply:s,onToggleShowIgnored:i,onRetry:c}){const d=r?n:n.filter(e=>!t.has(e.id));return(0,H.jsxs)(l.A,{vertical:!0,style:{flex:1,overflow:"hidden"},children:[(0,H.jsxs)("div",{style:{flex:1,overflowY:"auto",padding:"12px 12px 4px"},children:["analyzing"===e&&(0,H.jsxs)(l.A,{vertical:!0,align:"center",style:{paddingTop:40,gap:12},children:[(0,H.jsx)(M.A,{size:"large"}),(0,H.jsx)(V,{type:"secondary",children:"\u0410\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0435\u043c \u0442\u0435\u043a\u0441\u0442\u2026"})]}),"error"===e&&(0,H.jsx)(te,{icon:(0,H.jsx)(q.A,{style:{color:"#ff4d4f"}}),text:ee,action:(0,H.jsx)(re,{onClick:c})}),"idle"===e&&0===n.length&&(0,H.jsx)(te,{icon:(0,H.jsx)(X.A,{}),text:"\u041d\u0430\u0436\u043c\u0438\u0442\u0435 \xabAnalyze\xbb, \u0447\u0442\u043e\u0431\u044b \u043d\u0430\u0439\u0442\u0438 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u044b \u0432 \u0442\u0435\u043a\u0441\u0442\u0435."}),"done"===e&&0===n.length&&(0,H.jsx)(te,{text:"\u041f\u0440\u043e\u0431\u043b\u0435\u043c \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e."}),d.map(e=>(0,H.jsx)(U,{issue:e,onGoTo:o,onIgnore:a,onApply:s},e.id))]}),t.size>0&&(0,H.jsx)("div",{style:{padding:"8px 12px",borderTop:"1px solid #f0f0f0"},children:(0,H.jsx)(v.Ay,{type:"link",size:"small",style:{padding:0,fontSize:12},onClick:i,children:r?`\u0421\u043a\u0440\u044b\u0442\u044c \u0438\u0433\u043d\u043e\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0435 (${t.size})`:`\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0438\u0433\u043d\u043e\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0435 (${t.size})`})})]})}function ae({status:e,characters:n,onRetry:t}){return"analyzing"===e?(0,H.jsxs)(l.A,{vertical:!0,align:"center",style:{paddingTop:40,gap:12},children:[(0,H.jsx)(M.A,{size:"large"}),(0,H.jsx)(V,{type:"secondary",children:"\u0418\u0437\u0432\u043b\u0435\u043a\u0430\u0435\u043c \u043f\u0435\u0440\u0441\u043e\u043d\u0430\u0436\u0435\u0439\u2026"})]}):"error"===e?(0,H.jsx)(te,{icon:(0,H.jsx)(q.A,{style:{color:"#ff4d4f"}}),text:ee,action:(0,H.jsx)(re,{onClick:t})}):"done"!==e||0===n.length?(0,H.jsx)(te,{text:"idle"===e?"\u041d\u0430\u0436\u043c\u0438\u0442\u0435 \xabAnalyze\xbb, \u0447\u0442\u043e\u0431\u044b \u0438\u0437\u0432\u043b\u0435\u0447\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u0435\u0440\u0441\u043e\u043d\u0430\u0436\u0435\u0439.":"\u041f\u0435\u0440\u0441\u043e\u043d\u0430\u0436\u0435\u0439 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e."}):(0,H.jsx)("div",{style:{overflowY:"auto",padding:"12px 12px 4px",flex:1},children:n.map((e,n)=>(0,H.jsx)(N.A,{size:"small",style:{marginBottom:8,borderRadius:6},styles:{body:{padding:"8px 12px"}},title:(0,H.jsxs)(l.A,{align:"center",gap:8,children:[(0,H.jsx)(V,{strong:!0,style:{fontSize:14},children:e.name}),(0,H.jsx)(O.A,{color:_[e.role]??"default",style:{margin:0,fontSize:11},children:D[e.role]??e.role})]}),children:(0,H.jsx)(V,{type:"secondary",style:{fontSize:13},children:e.description})},n))})}function le({status:e,logicIssues:n,onGoTo:t,onIgnore:r,onRetry:o}){return"analyzing"===e?(0,H.jsxs)(l.A,{vertical:!0,align:"center",style:{paddingTop:40,gap:12},children:[(0,H.jsx)(M.A,{size:"large"}),(0,H.jsx)(V,{type:"secondary",children:"\u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c \u043b\u043e\u0433\u0438\u043a\u0443 \u0441\u044e\u0436\u0435\u0442\u0430\u2026"})]}):"error"===e?(0,H.jsx)(te,{icon:(0,H.jsx)(q.A,{style:{color:"#ff4d4f"}}),text:ee,action:(0,H.jsx)(re,{onClick:o})}):"done"!==e||0===n.length?(0,H.jsx)(te,{text:"idle"===e?"\u041d\u0430\u0436\u043c\u0438\u0442\u0435 \xabAnalyze\xbb, \u0447\u0442\u043e\u0431\u044b \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u043b\u043e\u0433\u0438\u043a\u0443 \u0441\u044e\u0436\u0435\u0442\u0430.":"\u041b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u043f\u0440\u043e\u0431\u043b\u0435\u043c \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e."}):(0,H.jsx)("div",{style:{overflowY:"auto",padding:"12px 12px 4px",flex:1},children:n.map(e=>(0,H.jsx)(U,{issue:e,onGoTo:t,onIgnore:r,onApply:()=>{},hideApply:!0},e.id))})}function se({status:e,scoring:n,onRetry:t}){if("analyzing"===e)return(0,H.jsxs)(l.A,{vertical:!0,align:"center",style:{paddingTop:40,gap:12},children:[(0,H.jsx)(M.A,{size:"large"}),(0,H.jsx)(V,{type:"secondary",children:"\u041e\u0446\u0435\u043d\u0438\u0432\u0430\u0435\u043c \u043f\u0440\u043e\u0438\u0437\u0432\u0435\u0434\u0435\u043d\u0438\u0435\u2026"})]});if("error"===e)return(0,H.jsx)(te,{icon:(0,H.jsx)(q.A,{style:{color:"#ff4d4f"}}),text:ee,action:(0,H.jsx)(re,{onClick:t})});if("done"!==e||!n)return(0,H.jsx)(te,{text:"idle"===e?"\u041d\u0430\u0436\u043c\u0438\u0442\u0435 \xabAnalyze\xbb, \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043e\u0446\u0435\u043d\u043a\u0443 \u043f\u0440\u043e\u0438\u0437\u0432\u0435\u0434\u0435\u043d\u0438\u044f.":"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043e\u0446\u0435\u043d\u043a\u0443."});const r=Object.keys(G);return(0,H.jsxs)("div",{style:{overflowY:"auto",padding:"16px 12px 8px",flex:1},children:[(0,H.jsx)(l.A,{wrap:!0,gap:6,style:{marginBottom:20},children:r.map(e=>{const{label:t,color:r}=ne(n[e].score);return(0,H.jsxs)(O.A,{color:r,style:{margin:0},children:[G[e],": ",t]},e)})}),r.map(e=>{const t=n[e],{label:r,color:o}=ne(t.score);return(0,H.jsxs)("div",{style:{marginBottom:16},children:[(0,H.jsxs)(l.A,{align:"center",gap:8,style:{marginBottom:4},children:[(0,H.jsx)(V,{style:{fontSize:13,fontWeight:500},children:G[e]}),(0,H.jsx)(O.A,{color:o,style:{margin:0},children:r})]}),(0,H.jsx)(V,{type:"secondary",style:{fontSize:12},children:t.description})]},e)})]})}function ie({issuesStatus:e,logicStatus:n,charactersStatus:t,scoringStatus:o,isAnalyzing:a,issues:s,logicIssues:i,characters:c,scoring:d,ignored:g,showIgnored:u,onAnalyze:x,onRetryIssues:y,onRetryLogic:p,onRetryCharacters:h,onRetryScoring:f,onGoTo:j,onIgnore:m,onApply:A,onToggleShowIgnored:b}){const[z,S]=(0,r.useState)("issues"),w=[{key:"issues",label:(0,H.jsxs)("span",{children:["\u041f\u0440\u043e\u0431\u043b\u0435\u043c\u044b",s?.length>0&&(0,H.jsx)(W.A,{count:s?.length,size:"small",style:{marginLeft:6}})]}),children:(0,H.jsx)(oe,{status:e,issues:s,ignored:g,showIgnored:u,onGoTo:j,onIgnore:m,onApply:A,onToggleShowIgnored:b,onRetry:y})},{key:"characters",label:(0,H.jsxs)("span",{children:["\u041f\u0435\u0440\u0441\u043e\u043d\u0430\u0436\u0438",c?.length>0&&(0,H.jsx)(W.A,{count:c?.length,size:"small",style:{marginLeft:6}})]}),children:(0,H.jsx)(ae,{status:t,characters:c,onRetry:h})},{key:"logic",label:(0,H.jsxs)("span",{children:["\u041b\u043e\u0433\u0438\u043a\u0430",i?.length>0&&(0,H.jsx)(W.A,{count:i?.length,size:"small",style:{marginLeft:6}})]}),children:(0,H.jsx)(le,{status:n,logicIssues:i,onGoTo:j,onIgnore:m,onRetry:p})},{key:"scoring",label:"\u041e\u0446\u0435\u043d\u043a\u0430",children:(0,H.jsx)(se,{status:o,scoring:d,onRetry:f})}];return(0,H.jsx)(J.A,{activeKey:z,onChange:S,size:"small",style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",height:"100%"},tabBarStyle:{margin:"0 12px",flexShrink:0},tabBarExtraContent:(0,H.jsx)(v.Ay,{type:"primary",size:"small",icon:(0,H.jsx)(K.A,{}),onClick:x,loading:a,disabled:a,style:{marginRight:4},children:"Analyze"}),items:w.map(e=>({...e,children:(0,H.jsx)(l.A,{vertical:!0,style:{flex:1,overflow:"hidden",height:"100%"},children:e.children})}))})}const ce=()=>{const e=(0,r.useRef)(null),n=(0,r.useRef)(null),[t,s]=(0,r.useState)(0),[x,y]=(0,r.useState)(null),[p,h]=(0,r.useState)("idle"),[f,w]=(0,r.useState)("idle"),[C,v]=(0,r.useState)("idle"),[k,R]=(0,r.useState)("idle"),[T,B]=(0,r.useState)([]),[I,$]=(0,r.useState)([]),[L,_]=(0,r.useState)([]),[D,G]=(0,r.useState)(null),[P,E]=(0,r.useState)(new Set),[M,N]=(0,r.useState)(!1),[O,W]=(0,r.useState)(()=>(navigator.language||"en").split("-")[0].toLowerCase()||"auto"),[J]=(0,o.n)(u,{client:j}),[Y]=(0,o.n)(i,{client:j}),[q]=(0,o.n)(c,{client:j}),[X]=(0,o.n)(d,{client:j}),[K]=(0,o.n)(g,{client:j});(0,r.useEffect)(()=>{(async function(){const e=await b();return new Promise((n,t)=>{const r=e.transaction(m,"readonly").objectStore(m).get(A);r.onsuccess=()=>n(r.result??null),r.onerror=()=>t(r.error)})})().then(n=>{n&&e.current&&(e.current.innerHTML=n,s(S(z(e.current))))})},[]);const Z=(0,r.useCallback)(()=>{n.current&&clearTimeout(n.current),n.current=setTimeout(async()=>{e.current&&(await async function(e){const n=await b();await new Promise((t,r)=>{const o=n.transaction(m,"readwrite");o.objectStore(m).put(e,A),o.oncomplete=()=>t(),o.onerror=()=>r(o.error)})}(e.current.innerHTML),y(new Date))},1e4)},[]),Q=(0,r.useCallback)(()=>{e.current&&s(S(z(e.current))),Z()},[Z]),U=(0,r.useCallback)(()=>{const n=e.current?z(e.current):"",t="auto"===O?function(e){if(!e||e.trim().length<15)return"en";const n=(e.match(/[\u0400-\u04FF]/g)||[]).length,t=n+(e.match(/[a-zA-Z]/g)||[]).length;return 0===t?"en":n/t>.35?"ru":"en"}(n):O;return{text:n,language:t}},[O]),V=(0,r.useCallback)(async()=>{const{text:e,language:n}=U();h("analyzing"),B([]);try{const{data:t,errors:r}=await Y({variables:{text:e,language:n}}),o=t?.BetaReaderController_analyzeIssues;if(r?.length||!o)return void h("error");B(o),E(new Set),h("done")}catch{h("error")}},[U,Y]),ee=(0,r.useCallback)(async()=>{const{text:e,language:n}=U();w("analyzing"),$([]);try{const{data:t,errors:r}=await q({variables:{text:e,language:n}}),o=t?.BetaReaderController_analyzeLogic;if(r?.length||!o)return void w("error");$(o),w("done")}catch{w("error")}},[U,q]),ne=(0,r.useCallback)(async()=>{const{text:e,language:n}=U();v("analyzing"),_([]);try{const{data:t,errors:r}=await X({variables:{text:e,language:n}}),o=t?.BetaReaderController_analyzeCharacters;if(r?.length||!o)return void v("error");_(o),v("done")}catch{v("error")}},[U,X]),te=(0,r.useCallback)(async()=>{const{text:e,language:n}=U();R("analyzing"),G(null);try{const{data:t,errors:r}=await K({variables:{text:e,language:n}}),o=t?.BetaReaderController_scoreText;if(r?.length||!o)return void R("error");G(o),R("done")}catch{R("error")}},[U,K]),re=(0,r.useCallback)(n=>{e.current&&(e.current.focus(),function(e,n){if(!n)return!1;const t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null);let r=t.nextNode();for(;r;){const o=r.textContent?.indexOf(n)??-1;if(-1!==o){const t=document.createRange();t.setStart(r,o),t.setEnd(r,o+n.length);const a=window.getSelection();a?.removeAllRanges(),a?.addRange(t);const l=t.getBoundingClientRect(),s=e.getBoundingClientRect();return e.scrollTop+=l.top-s.top-e.clientHeight/2,!0}r=t.nextNode()}}(e.current,n))},[]),oe=(0,r.useCallback)(e=>{E(n=>new Set([...n,e]))},[]),ae=(0,r.useCallback)((n,t)=>{e.current&&function(e,n,t){const r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null);let o=r.nextNode();for(;o;){const a=o.textContent?.indexOf(n)??-1;if(-1!==a){const r=document.createRange();r.setStart(o,a),r.setEnd(o,a+n.length),e.focus();const l=window.getSelection();return l?.removeAllRanges(),l?.addRange(r),document.execCommand("insertText",!1,t),!0}o=r.nextNode()}return!1}(e.current,n,t)&&(s(S(z(e.current))),Z())},[Z]),le="analyzing"===p||"analyzing"===f||"analyzing"===C||"analyzing"===k;return(0,H.jsxs)(a.A,{style:{height:"calc(100vh - 92px)",background:"#fff"},children:[(0,H.jsx)(a.A.Panel,{defaultSize:"60%",min:"25%",max:"75%",children:(0,H.jsx)(l.A,{vertical:!0,style:{height:"100%",overflow:"hidden",borderRight:"1px solid #f0f0f0"},children:(0,H.jsx)(F,{editorRef:e,language:O,onLanguageChange:W,wordCount:t,lastSaved:x,onInput:Q})})}),(0,H.jsx)(a.A.Panel,{children:(0,H.jsx)(l.A,{vertical:!0,style:{height:"100%",overflow:"hidden"},children:(0,H.jsx)(ie,{issuesStatus:p,logicStatus:f,charactersStatus:C,scoringStatus:k,isAnalyzing:le,issues:T,logicIssues:I,characters:L,scoring:D,ignored:P,showIgnored:M,onAnalyze:async()=>{if(!e.current)return;const{text:n,language:t}=U();h("analyzing"),w("analyzing"),v("analyzing"),R("analyzing"),B([]),$([]),_([]),G(null),E(new Set);try{const{data:e,errors:r}=await J({variables:{text:n,language:t}}),o=e?.BetaReaderController_analyzeText;if(r?.length||!o)return h("error"),w("error"),v("error"),void R("error");if(!(o.scoring||o.issues?.length||o.logicIssues?.length||o.characters?.length))return h("error"),w("error"),v("error"),void R("error");B(o.issues??[]),$(o.logicIssues??[]),_(o.characters??[]),G(o.scoring??null),h("done"),w("done"),v("done"),R(o.scoring?"done":"error")}catch{h("error"),w("error"),v("error"),R("error")}},onRetryIssues:V,onRetryLogic:ee,onRetryCharacters:ne,onRetryScoring:te,onGoTo:re,onIgnore:oe,onApply:ae,onToggleShowIgnored:()=>N(e=>!e)})})})]})}}}]);