"use strict";(globalThis.webpackChunkbetareader_app_site=globalThis.webpackChunkbetareader_app_site||[]).push([[897],{1897(e,n,t){t.d(n,{BetareaderPage:()=>de});var r=t(6540),o=t(2548),a=t(977),s=t(7087),l=t(6679);const i=l.J1`
  mutation BetaReaderController_analyzeIssues($text: String!, $language: String) {
    BetaReaderController_analyzeIssues(text: $text, language: $language) {
      id
      type
      fragment
      description
      suggestion
    }
  }
`,c=l.J1`
  mutation BetaReaderController_analyzeLogic($text: String!, $language: String) {
    BetaReaderController_analyzeLogic(text: $text, language: $language) {
      id
      type
      fragment
      description
      suggestion
    }
  }
`,d=l.J1`
  mutation BetaReaderController_analyzeCharacters($text: String!, $language: String) {
    BetaReaderController_analyzeCharacters(text: $text, language: $language) {
      name
      description
      role
    }
  }
`,g=l.J1`
  mutation BetaReaderController_scoreText($text: String!, $language: String) {
    BetaReaderController_scoreText(text: $text, language: $language) {
      general {
        score
        description
      }
      plotLogic {
        score
        description
      }
      characters {
        score
        description
      }
      readability {
        score
        description
      }
    }
  }
`,u=l.J1`
  mutation BetaReaderController_analyzeText($text: String!, $language: String) {
    BetaReaderController_analyzeText(text: $text, language: $language) {
      issues {
        id
        type
        fragment
        description
        suggestion
      }
      logicIssues {
        id
        type
        fragment
        description
        suggestion
      }
      characters {
        name
        description
        role
      }
      scoring {
        general {
          score
          description
        }
        plotLogic {
          score
          description
        }
        characters {
          score
          description
        }
        readability {
          score
          description
        }
      }
    }
  }
`;var h=t(1965),y=t(836),x=t(8882);const{hostname:p}=window.location,f="betareader.app"===p||"www.betareader.app"===p?"https://api.betareader.app":window.location.origin,m=new h.R({link:new y.P({uri:`${f}/public-api/graphql/v1`}),cache:new x.D({addTypename:!1}),defaultOptions:{query:{fetchPolicy:"no-cache",errorPolicy:"all"},mutate:{fetchPolicy:"no-cache",errorPolicy:"all"}}}),j="documents",b="main_doc";function S(){return new Promise((e,n)=>{const t=indexedDB.open("betareader_db",1);t.onupgradeneeded=()=>{t.result.createObjectStore(j)},t.onsuccess=()=>e(t.result),t.onerror=()=>n(t.error)})}function A(e){return e.innerText??""}function z(e){return e.trim().split(/\s+/).filter(Boolean).length}const C={placeholder:"Start writing your chapter here\u2026\n\nUse the toolbar for Bold, Italic, and Headings.\nText is auto-saved in the browser every 10 seconds.\n\nClick \xabAnalyze\xbb in the right panel to find issues.",words:"Words",savedAt:e=>`Saved at ${e}`,notSaved:"Not saved",bold:"Bold (Ctrl+B)",italic:"Italic (Ctrl+I)",h1:"Heading H1",h2:"Heading H2",paragraph:"Normal paragraph",aiLang:"Language for AI hints and descriptions",decreaseFont:"Decrease font size",increaseFont:"Increase font size",langAuto:"Auto",aiError:"AI service is temporarily unavailable. Please try again later.",retry:"Retry",tabIssues:"Issues",tabCharacters:"Characters",tabLogic:"Logic",tabScoring:"Score",analyzingIssues:"Analysing text\u2026",idleIssues:"Click \xabAnalyze\xbb to find issues in the text.",noIssues:"No issues found.",showIgnored:e=>`Show ignored (${e})`,hideIgnored:e=>`Hide ignored (${e})`,analyzingCharacters:"Extracting characters\u2026",idleCharacters:"Click \xabAnalyze\xbb to extract the character list.",noCharacters:"No characters found.",roleMain:"Main",roleSecondary:"Secondary",roleMentioned:"Mentioned",analyzingLogic:"Checking plot logic\u2026",idleLogic:"Click \xabAnalyze\xbb to check plot logic.",noLogicIssues:"No logic issues found.",analyzingScoring:"Evaluating your work\u2026",idleScoring:"Click \xabAnalyze\xbb to get a score for your work.",noScoring:"Could not get a score.",factorGeneral:"Overall impression",factorPlotLogic:"Plot logic",factorCharacters:"Character development",factorReadability:"Readability",scoreExcellent:"Excellent",scoreConvincing:"Convincing",scorePotential:"Has potential",scoreNeedsWork:"Needs work",scoreNeedsRevision:"Needs revision",suggestion:"Suggestion:",apply:"Apply",goTo:"Go to",suggest:"Suggest",hide:"Hide",ignore:"Ignore"},v={ru:{placeholder:"\u041d\u0430\u0447\u043d\u0438\u0442\u0435 \u043f\u0438\u0441\u0430\u0442\u044c \u0433\u043b\u0430\u0432\u0443 \u0437\u0434\u0435\u0441\u044c\u2026\n\n\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 \u043f\u0430\u043d\u0435\u043b\u044c \u0438\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442\u043e\u0432 \u0434\u043b\u044f \u0416\u0438\u0440\u043d\u043e\u0433\u043e, \u041a\u0443\u0440\u0441\u0438\u0432\u0430 \u0438 \u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u043e\u0432.\n\u0422\u0435\u043a\u0441\u0442 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u0442\u0441\u044f \u0432 \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0435 \u043a\u0430\u0436\u0434\u044b\u0435 10 \u0441\u0435\u043a\u0443\u043d\u0434.\n\n\u041d\u0430\u0436\u043c\u0438\u0442\u0435 \xabAnalyze\xbb \u0432 \u043f\u0440\u0430\u0432\u043e\u0439 \u043f\u0430\u043d\u0435\u043b\u0438 \u0447\u0442\u043e\u0431\u044b \u043d\u0430\u0439\u0442\u0438 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u044b.",words:"\u0421\u043b\u043e\u0432",savedAt:e=>`\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u043e \u0432 ${e}`,notSaved:"\u041d\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u043e",bold:"\u041f\u043e\u043b\u0443\u0436\u0438\u0440\u043d\u044b\u0439 (Ctrl+B)",italic:"\u041a\u0443\u0440\u0441\u0438\u0432 (Ctrl+I)",h1:"\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a H1",h2:"\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a H2",paragraph:"\u041e\u0431\u044b\u0447\u043d\u044b\u0439 \u0430\u0431\u0437\u0430\u0446",aiLang:"\u042f\u0437\u044b\u043a \u043f\u043e\u0434\u0441\u043a\u0430\u0437\u043e\u043a \u0438 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0439 \u043e\u0442 AI",decreaseFont:"\u0423\u043c\u0435\u043d\u044c\u0448\u0438\u0442\u044c \u0448\u0440\u0438\u0444\u0442",increaseFont:"\u0423\u0432\u0435\u043b\u0438\u0447\u0438\u0442\u044c \u0448\u0440\u0438\u0444\u0442",langAuto:"\u0410\u0432\u0442\u043e",aiError:"AI-\u0441\u0435\u0440\u0432\u0438\u0441 \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e \u043d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d. \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u043f\u043e\u0437\u0436\u0435.",retry:"\u041f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u044c",tabIssues:"\u041f\u0440\u043e\u0431\u043b\u0435\u043c\u044b",tabCharacters:"\u041f\u0435\u0440\u0441\u043e\u043d\u0430\u0436\u0438",tabLogic:"\u041b\u043e\u0433\u0438\u043a\u0430",tabScoring:"\u041e\u0446\u0435\u043d\u043a\u0430",analyzingIssues:"\u0410\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0435\u043c \u0442\u0435\u043a\u0441\u0442\u2026",idleIssues:"\u041d\u0430\u0436\u043c\u0438\u0442\u0435 \xabAnalyze\xbb, \u0447\u0442\u043e\u0431\u044b \u043d\u0430\u0439\u0442\u0438 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u044b \u0432 \u0442\u0435\u043a\u0441\u0442\u0435.",noIssues:"\u041f\u0440\u043e\u0431\u043b\u0435\u043c \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e.",showIgnored:e=>`\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0438\u0433\u043d\u043e\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0435 (${e})`,hideIgnored:e=>`\u0421\u043a\u0440\u044b\u0442\u044c \u0438\u0433\u043d\u043e\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0435 (${e})`,analyzingCharacters:"\u0418\u0437\u0432\u043b\u0435\u043a\u0430\u0435\u043c \u043f\u0435\u0440\u0441\u043e\u043d\u0430\u0436\u0435\u0439\u2026",idleCharacters:"\u041d\u0430\u0436\u043c\u0438\u0442\u0435 \xabAnalyze\xbb, \u0447\u0442\u043e\u0431\u044b \u0438\u0437\u0432\u043b\u0435\u0447\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u0435\u0440\u0441\u043e\u043d\u0430\u0436\u0435\u0439.",noCharacters:"\u041f\u0435\u0440\u0441\u043e\u043d\u0430\u0436\u0435\u0439 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e.",roleMain:"\u0413\u043b\u0430\u0432\u043d\u044b\u0439",roleSecondary:"\u0412\u0442\u043e\u0440\u043e\u0441\u0442\u0435\u043f\u0435\u043d\u043d\u044b\u0439",roleMentioned:"\u0423\u043f\u043e\u043c\u044f\u043d\u0443\u0442\u044b\u0439",analyzingLogic:"\u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c \u043b\u043e\u0433\u0438\u043a\u0443 \u0441\u044e\u0436\u0435\u0442\u0430\u2026",idleLogic:"\u041d\u0430\u0436\u043c\u0438\u0442\u0435 \xabAnalyze\xbb, \u0447\u0442\u043e\u0431\u044b \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u043b\u043e\u0433\u0438\u043a\u0443 \u0441\u044e\u0436\u0435\u0442\u0430.",noLogicIssues:"\u041b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u043f\u0440\u043e\u0431\u043b\u0435\u043c \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e.",analyzingScoring:"\u041e\u0446\u0435\u043d\u0438\u0432\u0430\u0435\u043c \u043f\u0440\u043e\u0438\u0437\u0432\u0435\u0434\u0435\u043d\u0438\u0435\u2026",idleScoring:"\u041d\u0430\u0436\u043c\u0438\u0442\u0435 \xabAnalyze\xbb, \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043e\u0446\u0435\u043d\u043a\u0443 \u043f\u0440\u043e\u0438\u0437\u0432\u0435\u0434\u0435\u043d\u0438\u044f.",noScoring:"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043e\u0446\u0435\u043d\u043a\u0443.",factorGeneral:"\u041e\u0431\u0449\u0435\u0435 \u0432\u043e\u0441\u043f\u0440\u0438\u044f\u0442\u0438\u0435",factorPlotLogic:"\u041b\u043e\u0433\u0438\u043a\u0430 \u0441\u044e\u0436\u0435\u0442\u0430",factorCharacters:"\u041f\u0440\u043e\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043f\u0435\u0440\u0441\u043e\u043d\u0430\u0436\u0435\u0439",factorReadability:"\u0427\u0438\u0442\u0430\u0435\u043c\u043e\u0441\u0442\u044c",scoreExcellent:"\u041e\u0442\u043b\u0438\u0447\u043d\u043e",scoreConvincing:"\u0423\u0431\u0435\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e",scorePotential:"\u0415\u0441\u0442\u044c \u043f\u043e\u0442\u0435\u043d\u0446\u0438\u0430\u043b",scoreNeedsWork:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442 \u0440\u0430\u0431\u043e\u0442\u044b",scoreNeedsRevision:"\u041d\u0443\u0436\u043d\u0430 \u0434\u043e\u0440\u0430\u0431\u043e\u0442\u043a\u0430",suggestion:"\u041f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u0435:",apply:"\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c",goTo:"\u041f\u0435\u0440\u0435\u0439\u0442\u0438",suggest:"\u041f\u0440\u0435\u0434\u043b\u043e\u0436\u0438\u0442\u044c",hide:"\u0421\u043a\u0440\u044b\u0442\u044c",ignore:"\u0418\u0433\u043d\u043e\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c"},en:C},w="betareader_lang";function I(){const e=v[function(){let e=null;return"undefined"!=typeof localStorage&&(e=localStorage.getItem(w)),e&&"auto"!==e||"undefined"!=typeof navigator&&(e=navigator.language?.split("-")[0]??null),"ru"===e?"ru":"en"}()]??C;return{...e,characterRoleLabel:n=>({main:e.roleMain,secondary:e.roleSecondary,mentioned:e.roleMentioned}[n]??n),scoringFactorLabel:n=>({general:e.factorGeneral,plotLogic:e.factorPlotLogic,characters:e.factorCharacters,readability:e.factorReadability}[n]??n)}}var k=t(757),R=t(4800),T=t(1415),L=t(9754),B=t(1509),$=t(3840),_=t(9252),E=t(2792);const N=[{code:"auto",label:"\u0410\u0432\u0442\u043e"},{code:"ru",label:"\u0420\u0443\u0441\u0441\u043a\u0438\u0439"},{code:"en",label:"English"},{code:"uk",label:"\u0423\u043a\u0440\u0430\u0457\u043d\u0441\u044c\u043a\u0430"},{code:"de",label:"Deutsch"},{code:"fr",label:"Fran\xe7ais"},{code:"es",label:"Espa\xf1ol"},{code:"it",label:"Italiano"}],P={Spelling:"red",Repetition:"orange",Logic:"purple",Style:"green"},F={main:"gold",secondary:"blue",mentioned:"default"};var H=t(4848);function M({editorRef:e,language:n,onLanguageChange:t,fontSize:r,onFontSizeChange:o}){const a=I(),l=(n,t)=>{e.current?.focus(),document.execCommand(n,!1,t)};return(0,H.jsxs)(s.A,{align:"center",gap:4,style:{padding:"6px 10px",borderBottom:"1px solid #f0f0f0",background:"#fafafa",flexShrink:0},children:[(0,H.jsx)(R.A,{title:a.bold,children:(0,H.jsx)(T.Ay,{size:"small",icon:(0,H.jsx)($.A,{}),onMouseDown:e=>{e.preventDefault(),l("bold")}})}),(0,H.jsx)(R.A,{title:a.italic,children:(0,H.jsx)(T.Ay,{size:"small",icon:(0,H.jsx)(_.A,{}),onMouseDown:e=>{e.preventDefault(),l("italic")}})}),(0,H.jsx)(R.A,{title:a.h1,children:(0,H.jsx)(T.Ay,{size:"small",onMouseDown:e=>{e.preventDefault(),l("formatBlock","h1")},children:"H1"})}),(0,H.jsx)(R.A,{title:a.h2,children:(0,H.jsx)(T.Ay,{size:"small",onMouseDown:e=>{e.preventDefault(),l("formatBlock","h2")},children:"H2"})}),(0,H.jsx)(R.A,{title:a.paragraph,children:(0,H.jsx)(T.Ay,{size:"small",icon:(0,H.jsx)(E.A,{}),onMouseDown:e=>{e.preventDefault(),l("formatBlock","p")}})}),(0,H.jsx)(L.A,{type:"vertical",style:{margin:"0 4px"}}),(0,H.jsx)(R.A,{title:a.aiLang,children:(0,H.jsx)(B.A,{size:"small",value:n,onChange:e=>{localStorage.setItem(w,e),t(e)},style:{width:110},options:N.map(e=>({value:e.code,label:"auto"===e.code?a.langAuto:e.label}))})}),(0,H.jsx)(L.A,{type:"vertical",style:{margin:"0 4px"}}),(0,H.jsx)(R.A,{title:a.decreaseFont,children:(0,H.jsx)(T.Ay,{size:"small",disabled:r<=11,onClick:()=>{o(Math.max(11,r-1)),e.current?.focus()},children:"A\u2212"})}),(0,H.jsxs)("span",{style:{fontSize:12,color:"#8c8c8c",minWidth:30,textAlign:"center"},children:[r,"px"]}),(0,H.jsx)(R.A,{title:a.increaseFont,children:(0,H.jsx)(T.Ay,{size:"small",disabled:r>=32,onClick:()=>{o(Math.min(32,r+1)),e.current?.focus()},children:"A+"})})]})}const{Text:D}=k.A;function G({editorRef:e,language:n,onLanguageChange:t,wordCount:o,lastSaved:a,onInput:l}){const[i,c]=(0,r.useState)(17),d=I();return(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(M,{editorRef:e,language:n,onLanguageChange:t,fontSize:i,onFontSizeChange:c}),(0,H.jsx)("div",{ref:e,contentEditable:!0,suppressContentEditableWarning:!0,onInput:l,"data-placeholder":d.placeholder,style:{flex:1,overflowY:"auto",padding:"24px 32px",outline:"none",fontSize:i,lineHeight:1.8,fontFamily:'"Georgia", "Times New Roman", serif',color:"#1a1a1a",whiteSpace:"pre-wrap",wordBreak:"break-word"}}),(0,H.jsxs)(s.A,{justify:"space-between",align:"center",style:{padding:"6px 16px",borderTop:"1px solid #f0f0f0",background:"#fafafa",flexShrink:0},children:[(0,H.jsxs)(D,{type:"secondary",style:{fontSize:12},children:[d.words,": ",(0,H.jsx)("strong",{children:o})]}),(0,H.jsx)(D,{type:"secondary",style:{fontSize:12},children:a?d.savedAt(a.toLocaleTimeString()):d.notSaved})]})]})}var W=t(2188),O=t(7354),J=t(1682),Y=t(4423),q=t(5487),X=t(4709),K=t(4204),U=t(5954),Z=t(5901),Q=t(91);const{Text:V}=k.A;function ee({issue:e,onGoTo:n,onIgnore:t,onApply:o,hideApply:a=!1}){const[s,l]=(0,r.useState)(!1),i=I();return(0,H.jsxs)(O.A,{size:"small",style:{marginBottom:8,borderRadius:6},styles:{body:{padding:"8px 12px"}},title:(0,H.jsx)(J.A,{color:P[e.type]??"default",style:{margin:0},children:e.type}),children:[(0,H.jsxs)("blockquote",{style:{borderLeft:"3px solid #d9d9d9",marginLeft:0,paddingLeft:10,color:"#595959",fontStyle:"italic",fontSize:13,marginBottom:6},children:['"',e.fragment,'"']}),(0,H.jsx)(V,{type:"secondary",style:{fontSize:13,display:"block",marginBottom:8},children:e.description}),!a&&s&&(0,H.jsxs)("div",{style:{background:"#f6ffed",border:"1px solid #b7eb8f",borderRadius:4,padding:"6px 10px",marginBottom:8,fontSize:13},children:[(0,H.jsx)(V,{strong:!0,style:{display:"block",marginBottom:4,fontSize:12,color:"#52c41a"},children:i.suggestion}),(0,H.jsxs)(V,{style:{fontSize:13},children:['"',e.suggestion,'"']}),(0,H.jsx)("div",{style:{marginTop:6},children:(0,H.jsx)(T.Ay,{size:"small",type:"primary",onClick:()=>{o(e.fragment,e.suggestion),l(!1)},children:i.apply})})]}),(0,H.jsxs)(Q.A,{size:4,children:[(0,H.jsx)(T.Ay,{size:"small",onClick:()=>n(e.fragment),children:i.goTo}),!a&&(0,H.jsx)(T.Ay,{size:"small",onClick:()=>l(e=>!e),children:s?i.hide:i.suggest}),(0,H.jsx)(T.Ay,{size:"small",danger:!0,onClick:()=>t(e.id),children:i.ignore})]})]})}const ne=["general","plotLogic","characters","readability"],{Text:te}=k.A;function re({icon:e,text:n,action:t}){return(0,H.jsxs)(s.A,{vertical:!0,align:"center",justify:"center",style:{paddingTop:40,gap:12},children:[e&&(0,H.jsx)("div",{style:{fontSize:32,color:"#bfbfbf"},children:e}),(0,H.jsx)(te,{type:"secondary",children:n}),t]})}function oe({onClick:e}){const n=I();return(0,H.jsx)(T.Ay,{size:"small",icon:(0,H.jsx)(X.A,{}),onClick:e,children:n.retry})}function ae({status:e,issues:n,ignored:t,showIgnored:r,onGoTo:o,onIgnore:a,onApply:l,onToggleShowIgnored:i,onRetry:c}){const d=I(),g=r?n:n.filter(e=>!t.has(e.id));return(0,H.jsxs)(s.A,{vertical:!0,style:{flex:1,overflow:"hidden"},children:[(0,H.jsxs)("div",{style:{flex:1,overflowY:"auto",padding:"12px 12px 4px"},children:["analyzing"===e&&(0,H.jsxs)(s.A,{vertical:!0,align:"center",style:{paddingTop:40,gap:12},children:[(0,H.jsx)(W.A,{size:"large"}),(0,H.jsx)(te,{type:"secondary",children:d.analyzingIssues})]}),"error"===e&&(0,H.jsx)(re,{icon:(0,H.jsx)(K.A,{style:{color:"#ff4d4f"}}),text:d.aiError,action:(0,H.jsx)(oe,{onClick:c})}),"idle"===e&&0===n.length&&(0,H.jsx)(re,{icon:(0,H.jsx)(U.A,{}),text:d.idleIssues}),"done"===e&&0===n.length&&(0,H.jsx)(re,{text:d.noIssues}),g.map(e=>(0,H.jsx)(ee,{issue:e,onGoTo:o,onIgnore:a,onApply:l},e.id))]}),t.size>0&&(0,H.jsx)("div",{style:{padding:"8px 12px",borderTop:"1px solid #f0f0f0"},children:(0,H.jsx)(T.Ay,{type:"link",size:"small",style:{padding:0,fontSize:12},onClick:i,children:r?d.hideIgnored(t.size):d.showIgnored(t.size)})})]})}function se({status:e,characters:n,onRetry:t}){const r=I();return"analyzing"===e?(0,H.jsxs)(s.A,{vertical:!0,align:"center",style:{paddingTop:40,gap:12},children:[(0,H.jsx)(W.A,{size:"large"}),(0,H.jsx)(te,{type:"secondary",children:r.analyzingCharacters})]}):"error"===e?(0,H.jsx)(re,{icon:(0,H.jsx)(K.A,{style:{color:"#ff4d4f"}}),text:r.aiError,action:(0,H.jsx)(oe,{onClick:t})}):"done"!==e||0===n.length?(0,H.jsx)(re,{text:"idle"===e?r.idleCharacters:r.noCharacters}):(0,H.jsx)("div",{style:{overflowY:"auto",padding:"12px 12px 4px",flex:1},children:n.map((e,n)=>(0,H.jsx)(O.A,{size:"small",style:{marginBottom:8,borderRadius:6},styles:{body:{padding:"8px 12px"}},title:(0,H.jsxs)(s.A,{align:"center",gap:8,children:[(0,H.jsx)(te,{strong:!0,style:{fontSize:14},children:e.name}),(0,H.jsx)(J.A,{color:F[e.role]??"default",style:{margin:0,fontSize:11},children:r.characterRoleLabel(e.role)})]}),children:(0,H.jsx)(te,{type:"secondary",style:{fontSize:13},children:e.description})},n))})}function le({status:e,logicIssues:n,onGoTo:t,onIgnore:r,onRetry:o}){const a=I();return"analyzing"===e?(0,H.jsxs)(s.A,{vertical:!0,align:"center",style:{paddingTop:40,gap:12},children:[(0,H.jsx)(W.A,{size:"large"}),(0,H.jsx)(te,{type:"secondary",children:a.analyzingLogic})]}):"error"===e?(0,H.jsx)(re,{icon:(0,H.jsx)(K.A,{style:{color:"#ff4d4f"}}),text:a.aiError,action:(0,H.jsx)(oe,{onClick:o})}):"done"!==e||0===n.length?(0,H.jsx)(re,{text:"idle"===e?a.idleLogic:a.noLogicIssues}):(0,H.jsx)("div",{style:{overflowY:"auto",padding:"12px 12px 4px",flex:1},children:n.map(e=>(0,H.jsx)(ee,{issue:e,onGoTo:t,onIgnore:r,onApply:()=>{},hideApply:!0},e.id))})}function ie({status:e,scoring:n,onRetry:t}){const r=I();function o(e){return e>=9?{label:r.scoreExcellent,color:"success"}:e>=7?{label:r.scoreConvincing,color:"purple"}:e>=5?{label:r.scorePotential,color:"cyan"}:e>=3?{label:r.scoreNeedsWork,color:"orange"}:{label:r.scoreNeedsRevision,color:"error"}}if("analyzing"===e)return(0,H.jsxs)(s.A,{vertical:!0,align:"center",style:{paddingTop:40,gap:12},children:[(0,H.jsx)(W.A,{size:"large"}),(0,H.jsx)(te,{type:"secondary",children:r.analyzingScoring})]});if("error"===e)return(0,H.jsx)(re,{icon:(0,H.jsx)(K.A,{style:{color:"#ff4d4f"}}),text:r.aiError,action:(0,H.jsx)(oe,{onClick:t})});if("done"!==e||!n)return(0,H.jsx)(re,{text:"idle"===e?r.idleScoring:r.noScoring});const a=ne;return(0,H.jsxs)("div",{style:{overflowY:"auto",padding:"16px 12px 8px",flex:1},children:[(0,H.jsx)(s.A,{wrap:!0,gap:6,style:{marginBottom:20},children:a.map(e=>{const{label:t,color:a}=o(n[e].score);return(0,H.jsxs)(J.A,{color:a,style:{margin:0},children:[r.scoringFactorLabel(e),": ",t]},e)})}),a.map(e=>{const t=n[e],{label:a,color:l}=o(t.score);return(0,H.jsxs)("div",{style:{marginBottom:16},children:[(0,H.jsxs)(s.A,{align:"center",gap:8,style:{marginBottom:4},children:[(0,H.jsx)(te,{style:{fontSize:13,fontWeight:500},children:r.scoringFactorLabel(e)}),(0,H.jsx)(J.A,{color:l,style:{margin:0},children:a})]}),(0,H.jsx)(te,{type:"secondary",style:{fontSize:12},children:t.description})]},e)})]})}function ce({issuesStatus:e,logicStatus:n,charactersStatus:t,scoringStatus:o,isAnalyzing:a,issues:l,logicIssues:i,characters:c,scoring:d,ignored:g,showIgnored:u,onAnalyze:h,onRetryIssues:y,onRetryLogic:x,onRetryCharacters:p,onRetryScoring:f,onGoTo:m,onIgnore:j,onApply:b,onToggleShowIgnored:S}){const[A,z]=(0,r.useState)("issues"),C=I(),v=[{key:"issues",label:(0,H.jsxs)("span",{children:[C.tabIssues,l?.length>0&&(0,H.jsx)(Y.A,{count:l?.length,size:"small",style:{marginLeft:6}})]}),children:(0,H.jsx)(ae,{status:e,issues:l,ignored:g,showIgnored:u,onGoTo:m,onIgnore:j,onApply:b,onToggleShowIgnored:S,onRetry:y})},{key:"characters",label:(0,H.jsxs)("span",{children:[C.tabCharacters,c?.length>0&&(0,H.jsx)(Y.A,{count:c?.length,size:"small",style:{marginLeft:6}})]}),children:(0,H.jsx)(se,{status:t,characters:c,onRetry:p})},{key:"logic",label:(0,H.jsxs)("span",{children:[C.tabLogic,i?.length>0&&(0,H.jsx)(Y.A,{count:i?.length,size:"small",style:{marginLeft:6}})]}),children:(0,H.jsx)(le,{status:n,logicIssues:i,onGoTo:m,onIgnore:j,onRetry:x})},{key:"scoring",label:C.tabScoring,children:(0,H.jsx)(ie,{status:o,scoring:d,onRetry:f})}];return(0,H.jsx)(q.A,{activeKey:A,onChange:z,size:"small",style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",height:"100%"},tabBarStyle:{margin:"0 12px",flexShrink:0},tabBarExtraContent:(0,H.jsx)(T.Ay,{type:"primary",size:"small",icon:(0,H.jsx)(Z.A,{}),onClick:h,loading:a,disabled:a,style:{marginRight:4},children:"Analyze"}),items:v.map(e=>({...e,children:(0,H.jsx)(s.A,{vertical:!0,style:{flex:1,overflow:"hidden",height:"100%"},children:e.children})}))})}const de=()=>{const e=(0,r.useRef)(null),n=(0,r.useRef)(null),[t,l]=(0,r.useState)(0),[h,y]=(0,r.useState)(null),[x,p]=(0,r.useState)("idle"),[f,C]=(0,r.useState)("idle"),[v,I]=(0,r.useState)("idle"),[k,R]=(0,r.useState)("idle"),[T,L]=(0,r.useState)([]),[B,$]=(0,r.useState)([]),[_,E]=(0,r.useState)([]),[N,P]=(0,r.useState)(null),[F,M]=(0,r.useState)(new Set),[D,W]=(0,r.useState)(!1),[O,J]=(0,r.useState)(()=>localStorage.getItem(w)||(navigator.language||"en").split("-")[0].toLowerCase()||"auto"),[Y]=(0,o.n)(u,{client:m}),[q]=(0,o.n)(i,{client:m}),[X]=(0,o.n)(c,{client:m}),[K]=(0,o.n)(d,{client:m}),[U]=(0,o.n)(g,{client:m});(0,r.useEffect)(()=>{(async function(){const e=await S();return new Promise((n,t)=>{const r=e.transaction(j,"readonly").objectStore(j).get(b);r.onsuccess=()=>n(r.result??null),r.onerror=()=>t(r.error)})})().then(n=>{n&&e.current&&(e.current.innerHTML=n,l(z(A(e.current))))})},[]);const Z=(0,r.useCallback)(()=>{n.current&&clearTimeout(n.current),n.current=setTimeout(async()=>{e.current&&(await async function(e){const n=await S();await new Promise((t,r)=>{const o=n.transaction(j,"readwrite");o.objectStore(j).put(e,b),o.oncomplete=()=>t(),o.onerror=()=>r(o.error)})}(e.current.innerHTML),y(new Date))},1e4)},[]),Q=(0,r.useCallback)(()=>{e.current&&l(z(A(e.current))),Z()},[Z]),V=(0,r.useCallback)(()=>{const n=e.current?A(e.current):"",t="auto"===O?function(e){if(!e||e.trim().length<15)return"en";const n=(e.match(/[\u0400-\u04FF]/g)||[]).length,t=n+(e.match(/[a-zA-Z]/g)||[]).length;return 0===t?"en":n/t>.35?"ru":"en"}(n):O;return{text:n,language:t}},[O]),ee=(0,r.useCallback)(async()=>{const{text:e,language:n}=V();p("analyzing"),L([]);try{const{data:t,errors:r}=await q({variables:{text:e,language:n}}),o=t?.BetaReaderController_analyzeIssues;if(r?.length||!o)return void p("error");L(o),M(new Set),p("done")}catch{p("error")}},[V,q]),ne=(0,r.useCallback)(async()=>{const{text:e,language:n}=V();C("analyzing"),$([]);try{const{data:t,errors:r}=await X({variables:{text:e,language:n}}),o=t?.BetaReaderController_analyzeLogic;if(r?.length||!o)return void C("error");$(o),C("done")}catch{C("error")}},[V,X]),te=(0,r.useCallback)(async()=>{const{text:e,language:n}=V();I("analyzing"),E([]);try{const{data:t,errors:r}=await K({variables:{text:e,language:n}}),o=t?.BetaReaderController_analyzeCharacters;if(r?.length||!o)return void I("error");E(o),I("done")}catch{I("error")}},[V,K]),re=(0,r.useCallback)(async()=>{const{text:e,language:n}=V();R("analyzing"),P(null);try{const{data:t,errors:r}=await U({variables:{text:e,language:n}}),o=t?.BetaReaderController_scoreText;if(r?.length||!o)return void R("error");P(o),R("done")}catch{R("error")}},[V,U]),oe=(0,r.useCallback)(n=>{e.current&&(e.current.focus(),function(e,n){if(!n)return!1;const t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null);let r=t.nextNode();for(;r;){const o=r.textContent?.indexOf(n)??-1;if(-1!==o){const t=document.createRange();t.setStart(r,o),t.setEnd(r,o+n.length);const a=window.getSelection();a?.removeAllRanges(),a?.addRange(t);const s=t.getBoundingClientRect(),l=e.getBoundingClientRect();return e.scrollTop+=s.top-l.top-e.clientHeight/2,!0}r=t.nextNode()}}(e.current,n))},[]),ae=(0,r.useCallback)(e=>{M(n=>new Set([...n,e]))},[]),se=(0,r.useCallback)((n,t)=>{e.current&&function(e,n,t){const r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null);let o=r.nextNode();for(;o;){const a=o.textContent?.indexOf(n)??-1;if(-1!==a){const r=document.createRange();r.setStart(o,a),r.setEnd(o,a+n.length),e.focus();const s=window.getSelection();return s?.removeAllRanges(),s?.addRange(r),document.execCommand("insertText",!1,t),!0}o=r.nextNode()}return!1}(e.current,n,t)&&(l(z(A(e.current))),Z())},[Z]),le="analyzing"===x||"analyzing"===f||"analyzing"===v||"analyzing"===k;return(0,H.jsxs)(a.A,{style:{height:"calc(100vh - 92px)",background:"#fff"},children:[(0,H.jsx)(a.A.Panel,{defaultSize:"60%",min:"25%",max:"75%",children:(0,H.jsx)(s.A,{vertical:!0,style:{height:"100%",overflow:"hidden",borderRight:"1px solid #f0f0f0"},children:(0,H.jsx)(G,{editorRef:e,language:O,onLanguageChange:J,wordCount:t,lastSaved:h,onInput:Q})})}),(0,H.jsx)(a.A.Panel,{children:(0,H.jsx)(s.A,{vertical:!0,style:{height:"100%",overflow:"hidden"},children:(0,H.jsx)(ce,{issuesStatus:x,logicStatus:f,charactersStatus:v,scoringStatus:k,isAnalyzing:le,issues:T,logicIssues:B,characters:_,scoring:N,ignored:F,showIgnored:D,onAnalyze:async()=>{if(!e.current)return;const{text:n,language:t}=V();p("analyzing"),C("analyzing"),I("analyzing"),R("analyzing"),L([]),$([]),E([]),P(null),M(new Set);try{const{data:e,errors:r}=await Y({variables:{text:n,language:t}}),o=e?.BetaReaderController_analyzeText;if(r?.length||!o)return p("error"),C("error"),I("error"),void R("error");if(!(o.scoring||o.issues?.length||o.logicIssues?.length||o.characters?.length))return p("error"),C("error"),I("error"),void R("error");L(o.issues??[]),$(o.logicIssues??[]),E(o.characters??[]),P(o.scoring??null),p("done"),C("done"),I("done"),R(o.scoring?"done":"error")}catch{p("error"),C("error"),I("error"),R("error")}},onRetryIssues:ee,onRetryLogic:ne,onRetryCharacters:te,onRetryScoring:re,onGoTo:oe,onIgnore:ae,onApply:se,onToggleShowIgnored:()=>W(e=>!e)})})})]})}}}]);