"use strict";(globalThis.webpackChunkbetareader_app_site=globalThis.webpackChunkbetareader_app_site||[]).push([[84],{3084(e,n,t){t.d(n,{BetareaderPage:()=>oe});var r=t(6540),o=t(2548),s=t(977),l=t(7087),a=t(6679);a.J1`
  mutation BetaReaderController_analyzeIssues($text: String!, $language: String) {
    BetaReaderController_analyzeIssues(text: $text, language: $language) {
      id
      type
      fragment
      description
      suggestion
    }
  }
`,a.J1`
  mutation BetaReaderController_analyzeLogic($text: String!, $language: String) {
    BetaReaderController_analyzeLogic(text: $text, language: $language) {
      id
      type
      fragment
      description
      suggestion
    }
  }
`,a.J1`
  mutation BetaReaderController_analyzeCharacters($text: String!, $language: String) {
    BetaReaderController_analyzeCharacters(text: $text, language: $language) {
      name
      description
      role
    }
  }
`,a.J1`
  mutation BetaReaderController_scoreText($text: String!, $language: String) {
    BetaReaderController_scoreText(text: $text, language: $language) {
      general { score description }
      plotLogic { score description }
      characters { score description }
      readability { score description }
    }
  }
`;const i=a.J1`
  mutation BetaReaderController_analyzeText($text: String!, $language: String) {
    BetaReaderController_analyzeText(text: $text, language: $language) {
      issues {
        id
        type
        fragment
        description
        suggestion
      }
      logicIssues {
        id
        type
        fragment
        description
        suggestion
      }
      characters {
        name
        description
        role
      }
      scoring {
        general {
          score
          description
        }
        plotLogic {
          score
          description
        }
        characters {
          score
          description
        }
        readability {
          score
          description
        }
      }
    }
  }
`;var c=t(1965),d=t(836),g=t(8882);const{hostname:u}=window.location,x="betareader.app"===u||"www.betareader.app"===u?"https://api.betareader.app":window.location.origin,p=new c.R({link:new d.P({uri:`${x}/public-api/graphql/v1`}),cache:new g.D({addTypename:!1}),defaultOptions:{query:{fetchPolicy:"no-cache",errorPolicy:"all"},mutate:{fetchPolicy:"no-cache",errorPolicy:"all"}}}),h="documents",y="main_doc";function f(){return new Promise((e,n)=>{const t=indexedDB.open("betareader_db",1);t.onupgradeneeded=()=>{t.result.createObjectStore(h)},t.onsuccess=()=>e(t.result),t.onerror=()=>n(t.error)})}function j(e){return e.innerText??""}function m(e){return e.trim().split(/\s+/).filter(Boolean).length}var A=t(757),b=t(4800),z=t(1415),S=t(9754),w=t(1509),v=t(3840),C=t(9252),T=t(2792);const k=[{code:"auto",label:"\u0410\u0432\u0442\u043e"},{code:"ru",label:"\u0420\u0443\u0441\u0441\u043a\u0438\u0439"},{code:"en",label:"English"},{code:"uk",label:"\u0423\u043a\u0440\u0430\u0457\u043d\u0441\u044c\u043a\u0430"},{code:"de",label:"Deutsch"},{code:"fr",label:"Fran\xe7ais"},{code:"es",label:"Espa\xf1ol"},{code:"it",label:"Italiano"}],I={Spelling:"red",Repetition:"orange",Logic:"purple",Style:"green"},B={main:"gold",secondary:"blue",mentioned:"default"},R={main:"\u0413\u043b\u0430\u0432\u043d\u044b\u0439",secondary:"\u0412\u0442\u043e\u0440\u043e\u0441\u0442\u0435\u043f\u0435\u043d\u043d\u044b\u0439",mentioned:"\u0423\u043f\u043e\u043c\u044f\u043d\u0443\u0442\u044b\u0439"},$={general:"\u041e\u0431\u0449\u0435\u0435 \u0432\u043e\u0441\u043f\u0440\u0438\u044f\u0442\u0438\u0435",plotLogic:"\u041b\u043e\u0433\u0438\u043a\u0430 \u0441\u044e\u0436\u0435\u0442\u0430",characters:"\u041f\u0440\u043e\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043f\u0435\u0440\u0441\u043e\u043d\u0430\u0436\u0435\u0439",readability:"\u0427\u0438\u0442\u0430\u0435\u043c\u043e\u0441\u0442\u044c"};var L=t(4848);function _({editorRef:e,language:n,onLanguageChange:t,fontSize:r,onFontSizeChange:o}){const s=(n,t)=>{e.current?.focus(),document.execCommand(n,!1,t)};return(0,L.jsxs)(l.A,{align:"center",gap:4,style:{padding:"6px 10px",borderBottom:"1px solid #f0f0f0",background:"#fafafa",flexShrink:0},children:[(0,L.jsx)(b.A,{title:"\u041f\u043e\u043b\u0443\u0436\u0438\u0440\u043d\u044b\u0439 (Ctrl+B)",children:(0,L.jsx)(z.Ay,{size:"small",icon:(0,L.jsx)(v.A,{}),onMouseDown:e=>{e.preventDefault(),s("bold")}})}),(0,L.jsx)(b.A,{title:"\u041a\u0443\u0440\u0441\u0438\u0432 (Ctrl+I)",children:(0,L.jsx)(z.Ay,{size:"small",icon:(0,L.jsx)(C.A,{}),onMouseDown:e=>{e.preventDefault(),s("italic")}})}),(0,L.jsx)(b.A,{title:"\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a H1",children:(0,L.jsx)(z.Ay,{size:"small",onMouseDown:e=>{e.preventDefault(),s("formatBlock","h1")},children:"H1"})}),(0,L.jsx)(b.A,{title:"\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a H2",children:(0,L.jsx)(z.Ay,{size:"small",onMouseDown:e=>{e.preventDefault(),s("formatBlock","h2")},children:"H2"})}),(0,L.jsx)(b.A,{title:"\u041e\u0431\u044b\u0447\u043d\u044b\u0439 \u0430\u0431\u0437\u0430\u0446",children:(0,L.jsx)(z.Ay,{size:"small",icon:(0,L.jsx)(T.A,{}),onMouseDown:e=>{e.preventDefault(),s("formatBlock","p")}})}),(0,L.jsx)(S.A,{type:"vertical",style:{margin:"0 4px"}}),(0,L.jsx)(b.A,{title:"\u042f\u0437\u044b\u043a \u043f\u043e\u0434\u0441\u043a\u0430\u0437\u043e\u043a \u0438 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0439 \u043e\u0442 AI",children:(0,L.jsx)(w.A,{size:"small",value:n,onChange:t,style:{width:110},options:k.map(e=>({value:e.code,label:e.label}))})}),(0,L.jsx)(S.A,{type:"vertical",style:{margin:"0 4px"}}),(0,L.jsx)(b.A,{title:"\u0423\u043c\u0435\u043d\u044c\u0448\u0438\u0442\u044c \u0448\u0440\u0438\u0444\u0442",children:(0,L.jsx)(z.Ay,{size:"small",disabled:r<=11,onClick:()=>{o(Math.max(11,r-1)),e.current?.focus()},children:"A\u2212"})}),(0,L.jsxs)("span",{style:{fontSize:12,color:"#8c8c8c",minWidth:30,textAlign:"center"},children:[r,"px"]}),(0,L.jsx)(b.A,{title:"\u0423\u0432\u0435\u043b\u0438\u0447\u0438\u0442\u044c \u0448\u0440\u0438\u0444\u0442",children:(0,L.jsx)(z.Ay,{size:"small",disabled:r>=32,onClick:()=>{o(Math.min(32,r+1)),e.current?.focus()},children:"A+"})})]})}const{Text:D}=A.A;function G({editorRef:e,language:n,onLanguageChange:t,wordCount:o,lastSaved:s,onInput:a}){const[i,c]=(0,r.useState)(17);return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(_,{editorRef:e,language:n,onLanguageChange:t,fontSize:i,onFontSizeChange:c}),(0,L.jsx)("div",{ref:e,contentEditable:!0,suppressContentEditableWarning:!0,onInput:a,"data-placeholder":"\u041d\u0430\u0447\u043d\u0438\u0442\u0435 \u043f\u0438\u0441\u0430\u0442\u044c \u0433\u043b\u0430\u0432\u0443 \u0437\u0434\u0435\u0441\u044c\u2026\n\n\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 \u043f\u0430\u043d\u0435\u043b\u044c \u0438\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442\u043e\u0432 \u0434\u043b\u044f \u0416\u0438\u0440\u043d\u043e\u0433\u043e, \u041a\u0443\u0440\u0441\u0438\u0432\u0430 \u0438 \u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u043e\u0432.\n\u0422\u0435\u043a\u0441\u0442 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u0442\u0441\u044f \u0432 \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0435 \u043a\u0430\u0436\u0434\u044b\u0435 10 \u0441\u0435\u043a\u0443\u043d\u0434.\n\n\u041d\u0430\u0436\u043c\u0438\u0442\u0435 \xabAnalyze\xbb \u0432 \u043f\u0440\u0430\u0432\u043e\u0439 \u043f\u0430\u043d\u0435\u043b\u0438 \u0447\u0442\u043e\u0431\u044b \u043d\u0430\u0439\u0442\u0438 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u044b.",style:{flex:1,overflowY:"auto",padding:"24px 32px",outline:"none",fontSize:i,lineHeight:1.8,fontFamily:'"Georgia", "Times New Roman", serif',color:"#1a1a1a",whiteSpace:"pre-wrap",wordBreak:"break-word"}}),(0,L.jsxs)(l.A,{justify:"space-between",align:"center",style:{padding:"6px 16px",borderTop:"1px solid #f0f0f0",background:"#fafafa",flexShrink:0},children:[(0,L.jsxs)(D,{type:"secondary",style:{fontSize:12},children:["\u0421\u043b\u043e\u0432: ",(0,L.jsx)("strong",{children:o})]}),(0,L.jsx)(D,{type:"secondary",style:{fontSize:12},children:s?`\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u043e \u0432 ${s.toLocaleTimeString()}`:"\u041d\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u043e"})]})]})}var H=t(2188),P=t(7354),E=t(1682),F=t(4423),M=t(5487),N=t(4204),O=t(5954),W=t(5901),J=t(91);const{Text:Y}=A.A;function q({issue:e,onGoTo:n,onIgnore:t,onApply:o,hideApply:s=!1}){const[l,a]=(0,r.useState)(!1);return(0,L.jsxs)(P.A,{size:"small",style:{marginBottom:8,borderRadius:6},styles:{body:{padding:"8px 12px"}},title:(0,L.jsx)(E.A,{color:I[e.type]??"default",style:{margin:0},children:e.type}),children:[(0,L.jsxs)("blockquote",{style:{borderLeft:"3px solid #d9d9d9",marginLeft:0,paddingLeft:10,color:"#595959",fontStyle:"italic",fontSize:13,marginBottom:6},children:['"',e.fragment,'"']}),(0,L.jsx)(Y,{type:"secondary",style:{fontSize:13,display:"block",marginBottom:8},children:e.description}),!s&&l&&(0,L.jsxs)("div",{style:{background:"#f6ffed",border:"1px solid #b7eb8f",borderRadius:4,padding:"6px 10px",marginBottom:8,fontSize:13},children:[(0,L.jsx)(Y,{strong:!0,style:{display:"block",marginBottom:4,fontSize:12,color:"#52c41a"},children:"\u041f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u0435:"}),(0,L.jsxs)(Y,{style:{fontSize:13},children:['"',e.suggestion,'"']}),(0,L.jsx)("div",{style:{marginTop:6},children:(0,L.jsx)(z.Ay,{size:"small",type:"primary",onClick:()=>{o(e.fragment,e.suggestion),a(!1)},children:"Apply"})})]}),(0,L.jsxs)(J.A,{size:4,children:[(0,L.jsx)(z.Ay,{size:"small",onClick:()=>n(e.fragment),children:"Go to"}),!s&&(0,L.jsx)(z.Ay,{size:"small",onClick:()=>a(e=>!e),children:l?"Hide":"Suggest"}),(0,L.jsx)(z.Ay,{size:"small",danger:!0,onClick:()=>t(e.id),children:"Ignore"})]})]})}const{Text:X}=A.A,K={idle:{text:"\u041e\u0436\u0438\u0434\u0430\u043d\u0438\u0435",status:"default"},analyzing:{text:"\u0410\u043d\u0430\u043b\u0438\u0437\u2026",status:"processing"},done:{text:"\u0413\u043e\u0442\u043e\u0432\u043e",status:"success"},error:{text:"\u0421\u0431\u043e\u0439 AI",status:"error"}},Z="AI-\u0441\u0435\u0440\u0432\u0438\u0441 \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e \u043d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d. \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u043f\u043e\u0437\u0436\u0435.";function Q(e){return e>=9?{label:"\u041e\u0442\u043b\u0438\u0447\u043d\u043e",color:"success"}:e>=7?{label:"\u0423\u0431\u0435\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e",color:"purple"}:e>=5?{label:"\u0415\u0441\u0442\u044c \u043f\u043e\u0442\u0435\u043d\u0446\u0438\u0430\u043b",color:"cyan"}:e>=3?{label:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442 \u0440\u0430\u0431\u043e\u0442\u044b",color:"orange"}:{label:"\u041d\u0443\u0436\u043d\u0430 \u0434\u043e\u0440\u0430\u0431\u043e\u0442\u043a\u0430",color:"error"}}function U({icon:e,text:n}){return(0,L.jsxs)(l.A,{vertical:!0,align:"center",justify:"center",style:{paddingTop:40},children:[e&&(0,L.jsx)("div",{style:{fontSize:32,color:"#bfbfbf",marginBottom:8},children:e}),(0,L.jsx)(X,{type:"secondary",children:n})]})}function V({status:e,issues:n,ignored:t,showIgnored:r,onGoTo:o,onIgnore:s,onApply:a,onToggleShowIgnored:i}){const c=r?n:n.filter(e=>!t.has(e.id));return(0,L.jsxs)(l.A,{vertical:!0,style:{flex:1,overflow:"hidden"},children:[(0,L.jsxs)("div",{style:{flex:1,overflowY:"auto",padding:"12px 12px 4px"},children:["analyzing"===e&&(0,L.jsxs)(l.A,{vertical:!0,align:"center",style:{paddingTop:40,gap:12},children:[(0,L.jsx)(H.A,{size:"large"}),(0,L.jsx)(X,{type:"secondary",children:"\u0410\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0435\u043c \u0442\u0435\u043a\u0441\u0442\u2026"})]}),"error"===e&&(0,L.jsx)(U,{icon:(0,L.jsx)(N.A,{style:{color:"#ff4d4f"}}),text:Z}),"idle"===e&&0===n.length&&(0,L.jsx)(U,{icon:(0,L.jsx)(O.A,{}),text:"\u041d\u0430\u0436\u043c\u0438\u0442\u0435 \xabAnalyze\xbb, \u0447\u0442\u043e\u0431\u044b \u043d\u0430\u0439\u0442\u0438 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u044b \u0432 \u0442\u0435\u043a\u0441\u0442\u0435."}),"done"===e&&0===n.length&&(0,L.jsx)(U,{text:"\u041f\u0440\u043e\u0431\u043b\u0435\u043c \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e."}),c.map(e=>(0,L.jsx)(q,{issue:e,onGoTo:o,onIgnore:s,onApply:a},e.id))]}),t.size>0&&(0,L.jsx)("div",{style:{padding:"8px 12px",borderTop:"1px solid #f0f0f0"},children:(0,L.jsx)(z.Ay,{type:"link",size:"small",style:{padding:0,fontSize:12},onClick:i,children:r?`\u0421\u043a\u0440\u044b\u0442\u044c \u0438\u0433\u043d\u043e\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0435 (${t.size})`:`\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0438\u0433\u043d\u043e\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0435 (${t.size})`})})]})}function ee({status:e,characters:n}){return"analyzing"===e?(0,L.jsxs)(l.A,{vertical:!0,align:"center",style:{paddingTop:40,gap:12},children:[(0,L.jsx)(H.A,{size:"large"}),(0,L.jsx)(X,{type:"secondary",children:"\u0418\u0437\u0432\u043b\u0435\u043a\u0430\u0435\u043c \u043f\u0435\u0440\u0441\u043e\u043d\u0430\u0436\u0435\u0439\u2026"})]}):"error"===e?(0,L.jsx)(U,{icon:(0,L.jsx)(N.A,{style:{color:"#ff4d4f"}}),text:Z}):"done"!==e||0===n.length?(0,L.jsx)(U,{text:"idle"===e?"\u041d\u0430\u0436\u043c\u0438\u0442\u0435 \xabAnalyze\xbb, \u0447\u0442\u043e\u0431\u044b \u0438\u0437\u0432\u043b\u0435\u0447\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u0435\u0440\u0441\u043e\u043d\u0430\u0436\u0435\u0439.":"\u041f\u0435\u0440\u0441\u043e\u043d\u0430\u0436\u0435\u0439 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e."}):(0,L.jsx)("div",{style:{overflowY:"auto",padding:"12px 12px 4px",flex:1},children:n.map((e,n)=>(0,L.jsx)(P.A,{size:"small",style:{marginBottom:8,borderRadius:6},styles:{body:{padding:"8px 12px"}},title:(0,L.jsxs)(l.A,{align:"center",gap:8,children:[(0,L.jsx)(X,{strong:!0,style:{fontSize:14},children:e.name}),(0,L.jsx)(E.A,{color:B[e.role]??"default",style:{margin:0,fontSize:11},children:R[e.role]??e.role})]}),children:(0,L.jsx)(X,{type:"secondary",style:{fontSize:13},children:e.description})},n))})}function ne({status:e,logicIssues:n,onGoTo:t,onIgnore:r}){return"analyzing"===e?(0,L.jsxs)(l.A,{vertical:!0,align:"center",style:{paddingTop:40,gap:12},children:[(0,L.jsx)(H.A,{size:"large"}),(0,L.jsx)(X,{type:"secondary",children:"\u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c \u043b\u043e\u0433\u0438\u043a\u0443 \u0441\u044e\u0436\u0435\u0442\u0430\u2026"})]}):"error"===e?(0,L.jsx)(U,{icon:(0,L.jsx)(N.A,{style:{color:"#ff4d4f"}}),text:Z}):"done"!==e||0===n.length?(0,L.jsx)(U,{text:"idle"===e?"\u041d\u0430\u0436\u043c\u0438\u0442\u0435 \xabAnalyze\xbb, \u0447\u0442\u043e\u0431\u044b \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u043b\u043e\u0433\u0438\u043a\u0443 \u0441\u044e\u0436\u0435\u0442\u0430.":"\u041b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u043f\u0440\u043e\u0431\u043b\u0435\u043c \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e."}):(0,L.jsx)("div",{style:{overflowY:"auto",padding:"12px 12px 4px",flex:1},children:n.map(e=>(0,L.jsx)(q,{issue:e,onGoTo:t,onIgnore:r,onApply:()=>{},hideApply:!0},e.id))})}function te({status:e,scoring:n}){if("analyzing"===e)return(0,L.jsxs)(l.A,{vertical:!0,align:"center",style:{paddingTop:40,gap:12},children:[(0,L.jsx)(H.A,{size:"large"}),(0,L.jsx)(X,{type:"secondary",children:"\u041e\u0446\u0435\u043d\u0438\u0432\u0430\u0435\u043c \u043f\u0440\u043e\u0438\u0437\u0432\u0435\u0434\u0435\u043d\u0438\u0435\u2026"})]});if("error"===e)return(0,L.jsx)(U,{icon:(0,L.jsx)(N.A,{style:{color:"#ff4d4f"}}),text:Z});if("done"!==e||!n)return(0,L.jsx)(U,{text:"idle"===e?"\u041d\u0430\u0436\u043c\u0438\u0442\u0435 \xabAnalyze\xbb, \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043e\u0446\u0435\u043d\u043a\u0443 \u043f\u0440\u043e\u0438\u0437\u0432\u0435\u0434\u0435\u043d\u0438\u044f.":"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043e\u0446\u0435\u043d\u043a\u0443."});const t=Object.keys($);return(0,L.jsxs)("div",{style:{overflowY:"auto",padding:"16px 12px 8px",flex:1},children:[(0,L.jsx)(l.A,{wrap:!0,gap:6,style:{marginBottom:20},children:t.map(e=>{const{label:t,color:r}=Q(n[e].score);return(0,L.jsxs)(E.A,{color:r,style:{margin:0},children:[$[e],": ",t]},e)})}),t.map(e=>{const t=n[e],{label:r,color:o}=Q(t.score);return(0,L.jsxs)("div",{style:{marginBottom:16},children:[(0,L.jsxs)(l.A,{align:"center",gap:8,style:{marginBottom:4},children:[(0,L.jsx)(X,{style:{fontSize:13,fontWeight:500},children:$[e]}),(0,L.jsx)(E.A,{color:o,style:{margin:0},children:r})]}),(0,L.jsx)(X,{type:"secondary",style:{fontSize:12},children:t.description})]},e)})]})}function re({status:e,issues:n,logicIssues:t,characters:o,scoring:s,ignored:a,showIgnored:i,onAnalyze:c,onGoTo:d,onIgnore:g,onApply:u,onToggleShowIgnored:x}){const[p,h]=(0,r.useState)("issues"),y=[{key:"issues",label:(0,L.jsxs)("span",{children:["\u041f\u0440\u043e\u0431\u043b\u0435\u043c\u044b",n?.length>0&&(0,L.jsx)(F.A,{count:n?.length,size:"small",style:{marginLeft:6}})]}),children:(0,L.jsx)(V,{status:e,issues:n,ignored:a,showIgnored:i,onGoTo:d,onIgnore:g,onApply:u,onToggleShowIgnored:x})},{key:"characters",label:(0,L.jsxs)("span",{children:["\u041f\u0435\u0440\u0441\u043e\u043d\u0430\u0436\u0438",o?.length>0&&(0,L.jsx)(F.A,{count:o?.length,size:"small",style:{marginLeft:6}})]}),children:(0,L.jsx)(ee,{status:e,characters:o})},{key:"logic",label:(0,L.jsxs)("span",{children:["\u041b\u043e\u0433\u0438\u043a\u0430",t?.length>0&&(0,L.jsx)(F.A,{count:t?.length,size:"small",style:{marginLeft:6}})]}),children:(0,L.jsx)(ne,{status:e,logicIssues:t,onGoTo:d,onIgnore:g})},{key:"scoring",label:"\u041e\u0446\u0435\u043d\u043a\u0430",children:(0,L.jsx)(te,{status:e,scoring:s})}];return(0,L.jsxs)(l.A,{vertical:!0,style:{height:"100%"},children:[(0,L.jsxs)(l.A,{align:"center",gap:12,style:{padding:"12px 16px",borderBottom:"1px solid #f0f0f0",flexShrink:0,background:"#fafafa"},children:[(0,L.jsx)(z.Ay,{type:"primary",icon:(0,L.jsx)(W.A,{}),onClick:c,loading:"analyzing"===e,disabled:"analyzing"===e,children:"Analyze"}),(0,L.jsx)(F.A,{status:K[e].status,text:(0,L.jsx)(X,{type:"secondary",style:{fontSize:13},children:K[e].text})})]}),(0,L.jsx)(M.A,{activeKey:p,onChange:h,size:"small",style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},tabBarStyle:{margin:"0 12px",flexShrink:0},items:y.map(e=>({...e,children:(0,L.jsx)(l.A,{vertical:!0,style:{flex:1,overflow:"hidden",height:"100%"},children:e.children})}))})]})}const oe=()=>{const e=(0,r.useRef)(null),n=(0,r.useRef)(null),[t,a]=(0,r.useState)(0),[c,d]=(0,r.useState)(null),[g,u]=(0,r.useState)("idle"),[x,A]=(0,r.useState)([]),[b,z]=(0,r.useState)([]),[S,w]=(0,r.useState)([]),[v,C]=(0,r.useState)(null),[T,k]=(0,r.useState)(new Set),[I,B]=(0,r.useState)(!1),[R,$]=(0,r.useState)(()=>(navigator.language||"en").split("-")[0].toLowerCase()||"auto"),[_]=(0,o.n)(i,{client:p});(0,r.useEffect)(()=>{(async function(){const e=await f();return new Promise((n,t)=>{const r=e.transaction(h,"readonly").objectStore(h).get(y);r.onsuccess=()=>n(r.result??null),r.onerror=()=>t(r.error)})})().then(n=>{n&&e.current&&(e.current.innerHTML=n,a(m(j(e.current))))})},[]);const D=(0,r.useCallback)(()=>{n.current&&clearTimeout(n.current),n.current=setTimeout(async()=>{e.current&&(await async function(e){const n=await f();await new Promise((t,r)=>{const o=n.transaction(h,"readwrite");o.objectStore(h).put(e,y),o.oncomplete=()=>t(),o.onerror=()=>r(o.error)})}(e.current.innerHTML),d(new Date))},1e4)},[]),H=(0,r.useCallback)(()=>{e.current&&a(m(j(e.current))),D()},[D]),P=(0,r.useCallback)(n=>{e.current&&(e.current.focus(),function(e,n){if(!n)return!1;const t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null);let r=t.nextNode();for(;r;){const o=r.textContent?.indexOf(n)??-1;if(-1!==o){const t=document.createRange();t.setStart(r,o),t.setEnd(r,o+n.length);const s=window.getSelection();s?.removeAllRanges(),s?.addRange(t);const l=t.getBoundingClientRect(),a=e.getBoundingClientRect();return e.scrollTop+=l.top-a.top-e.clientHeight/2,!0}r=t.nextNode()}}(e.current,n))},[]),E=(0,r.useCallback)(e=>{k(n=>new Set([...n,e]))},[]),F=(0,r.useCallback)((n,t)=>{e.current&&function(e,n,t){const r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null);let o=r.nextNode();for(;o;){const s=o.textContent?.indexOf(n)??-1;if(-1!==s){const r=document.createRange();r.setStart(o,s),r.setEnd(o,s+n.length),e.focus();const l=window.getSelection();return l?.removeAllRanges(),l?.addRange(r),document.execCommand("insertText",!1,t),!0}o=r.nextNode()}return!1}(e.current,n,t)&&(a(m(j(e.current))),D())},[D]);return(0,L.jsxs)(s.A,{style:{height:"calc(100vh - 92px)",background:"#fff"},children:[(0,L.jsx)(s.A.Panel,{defaultSize:"60%",min:"25%",max:"75%",children:(0,L.jsx)(l.A,{vertical:!0,style:{height:"100%",overflow:"hidden",borderRight:"1px solid #f0f0f0"},children:(0,L.jsx)(G,{editorRef:e,language:R,onLanguageChange:$,wordCount:t,lastSaved:c,onInput:H})})}),(0,L.jsx)(s.A.Panel,{children:(0,L.jsx)(l.A,{vertical:!0,style:{height:"100%",overflow:"hidden"},children:(0,L.jsx)(re,{status:g,issues:x,logicIssues:b,characters:S,scoring:v,ignored:T,showIgnored:I,onAnalyze:async()=>{if(!e.current)return;const n=j(e.current),t="auto"===R?function(e){if(!e||e.trim().length<15)return"en";const n=(e.match(/[\u0400-\u04FF]/g)||[]).length,t=n+(e.match(/[a-zA-Z]/g)||[]).length;return 0===t?"en":n/t>.35?"ru":"en"}(n):R;u("analyzing"),A([]),z([]),w([]),C(null);try{const{data:e,errors:r}=await _({variables:{text:n,language:t}}),o=e?.BetaReaderController_analyzeText;if(r?.length||!o)return void u("error");A(o.issues??[]),z(o.logicIssues??[]),w(o.characters??[]),C(o.scoring??null),k(new Set);const s=!(o.scoring||o.issues?.length||o.logicIssues?.length||o.characters?.length);u(s?"error":"done")}catch{u("error")}},onGoTo:P,onIgnore:E,onApply:F,onToggleShowIgnored:()=>B(e=>!e)})})})]})}}}]);